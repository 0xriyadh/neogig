# NeoGig Backend

This is the backend service for the NeoGig application, built with Express.js, tRPC, Drizzle ORM, and PostgreSQL.

## Project Structure

```
/
├── src/
│   ├── config/               # Configuration files (tRPC, etc.)
│   ├── controllers/          # Request handlers (tRPC procedures call these)
│   ├── db/
│   │   ├── migrations/       # Database migration files (generated by Drizzle Kit)
│   │   ├── schema/           # Drizzle ORM schema definitions
│   │   ├── index.ts          # Drizzle client initialization
│   │   └── migrate.ts        # Script to run migrations
│   ├── models/               # Zod schemas for data validation
│   ├── routes/               # tRPC routers
│   │   ├── index.ts          # Main tRPC app router
│   │   └── *.routes.ts       # Feature-specific routers
│   ├── services/             # Business logic
│   ├── utils/                # Utility functions
│   └── server.ts             # Express server setup and tRPC middleware
├── .env                      # Environment variables (DATABASE_URL, JWT_SECRET)
├── .gitignore                # Git ignore configuration
├── drizzle.config.ts         # Drizzle Kit configuration
├── package.json              # Project dependencies and scripts
├── tsconfig.json             # TypeScript configuration
└── README.md                 # This file
```

## Setup

1.  **Install dependencies:**
    ```bash
    npm install
    ```
2.  **Set up environment variables:**
    Create a `.env` file in the root directory and add your database connection string and a JWT secret:
    ```env
    DATABASE_URL=postgresql://YOUR_DB_USER:YOUR_DB_PASSWORD@YOUR_DB_HOST:YOUR_DB_PORT/YOUR_DB_NAME
    JWT_SECRET=your_super_secret_jwt_key_here
    ```
3.  **Set up PostgreSQL Database:**
    Ensure you have a PostgreSQL server running and create the database specified in your `DATABASE_URL`.

## Database Migrations

This project uses Drizzle ORM with Drizzle Kit for managing database schema and migrations.

1.  **Modify Schema:** Edit the table definitions in `src/db/schema/*.ts`.
2.  **Generate Migration:** Run the following command to create a new SQL migration file based on your schema changes:
    ```bash
    npm run db:generate
    ```
    This will create a new file in `src/db/migrations/`.
3.  **Apply Migration:** Run the migration against your database:
    ```bash
    npm run db:migrate
    ```

*Optional: Use Drizzle Studio to explore your database:* `npm run db:studio`

## Running the Application

*   **Development Mode (with hot-reloading):**
    ```bash
    npm run dev
    ```
    The server will start on `http://localhost:3000` (or the port specified in `.env`). Changes in the `src` directory will automatically restart the server.

*   **Production Mode:**
    1.  Build the TypeScript code:
        ```bash
        npm run build
        ```
    2.  Start the server:
        ```bash
        npm run start
        ```

## Adding New Features (Routes/Controllers)

1.  **Define Schema (if necessary):** Add or modify tables in `src/db/schema/`.
2.  **Generate & Apply Migrations:** Run `npm run db:generate` and `npm run db:migrate`.
3.  **Define Input Validation:** Create Zod schemas for your new endpoint inputs in `src/models/` (e.g., `src/models/feature.models.ts`).
4.  **Create Service:** Implement the core business logic in `src/services/` (e.g., `src/services/feature.service.ts`). This service will interact with the database (`src/db/index.ts`).
5.  **Create Controller:** Create a controller in `src/controllers/` (e.g., `src/controllers/feature.controller.ts`). This controller will instantiate and use the corresponding service.
6.  **Create tRPC Router:** Define the tRPC procedures in `src/routes/` (e.g., `src/routes/feature.routes.ts`). Import the controller and validation schemas. Use `publicProcedure` (or authenticated procedures later) and connect them to controller methods.
7.  **Mount Router:** Import your new feature router in `src/routes/index.ts` and add it to the `appRouter`.

## API Access

The tRPC API is available at `/trpc`. You can use a tRPC client in your frontend to interact with it type-safely.

Available procedures (so far):
*   `auth.signup`: Takes email, password, role ('applicant' or 'company'), name, and other role-specific fields.
*   `auth.login`: Takes email and password. 